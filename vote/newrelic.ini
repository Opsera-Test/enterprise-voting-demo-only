# ════════════════════════════════════════════════════════════════════════════════
# NEW RELIC PYTHON AGENT CONFIGURATION
#
# This config enables New Relic APM monitoring for the Vote service.
# Most settings are overridden by environment variables at runtime.
# ════════════════════════════════════════════════════════════════════════════════

[newrelic]
# License key - REQUIRED (set via NEW_RELIC_LICENSE_KEY env var)
license_key = %(NEW_RELIC_LICENSE_KEY)s

# Application name - set via NEW_RELIC_APP_NAME env var
app_name = %(NEW_RELIC_APP_NAME)s

# ═══════════════════════════════════════════════════════════════════════════════
# COLLECTOR CONFIGURATION - For Mock/Custom New Relic Server
# ═══════════════════════════════════════════════════════════════════════════════

# Custom collector host (mock server) - set via NEW_RELIC_HOST env var
# Default: collector.newrelic.com
host = %(NEW_RELIC_HOST)s

# Use HTTPS for collector connection
ssl = true

# ═══════════════════════════════════════════════════════════════════════════════
# AGENT BEHAVIOR
# ═══════════════════════════════════════════════════════════════════════════════

# Enable the agent
monitor_mode = true

# High security mode - disable for mock server compatibility
high_security = false

# Log level - set via NEW_RELIC_LOG_LEVEL env var
log_level = %(NEW_RELIC_LOG_LEVEL)s

# Log to stdout for container environments
log_file = stdout

# ═══════════════════════════════════════════════════════════════════════════════
# DISTRIBUTED TRACING
# ═══════════════════════════════════════════════════════════════════════════════

distributed_tracing.enabled = true

# ═══════════════════════════════════════════════════════════════════════════════
# TRANSACTION TRACER
# ═══════════════════════════════════════════════════════════════════════════════

transaction_tracer.enabled = true
transaction_tracer.transaction_threshold = apdex_f
transaction_tracer.record_sql = obfuscated
transaction_tracer.stack_trace_threshold = 0.5

# ═══════════════════════════════════════════════════════════════════════════════
# ERROR COLLECTOR
# ═══════════════════════════════════════════════════════════════════════════════

error_collector.enabled = true
error_collector.ignore_errors =
error_collector.ignore_status_codes = 100-102 200-208 226 300-308

# ═══════════════════════════════════════════════════════════════════════════════
# APPLICATION LOGGING (for canary analysis)
# ═══════════════════════════════════════════════════════════════════════════════

application_logging.enabled = true
application_logging.forwarding.enabled = true
application_logging.metrics.enabled = true
application_logging.local_decorating.enabled = false

# ═══════════════════════════════════════════════════════════════════════════════
# BROWSER MONITORING (disabled for API service)
# ═══════════════════════════════════════════════════════════════════════════════

browser_monitoring.auto_instrument = false

# ═══════════════════════════════════════════════════════════════════════════════
# ATTRIBUTES
# ═══════════════════════════════════════════════════════════════════════════════

attributes.enabled = true
attributes.include = request.parameters.*

# ═══════════════════════════════════════════════════════════════════════════════
# CUSTOM INSIGHTS EVENTS
# ═══════════════════════════════════════════════════════════════════════════════

custom_insights_events.enabled = true
